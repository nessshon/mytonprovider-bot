# ü§ñ MyTONProvider Bot

[![TON](https://img.shields.io/badge/TON-grey?logo=TON\&logoColor=40AEF0)](https://ton.org)
[![Telegram Bot](https://img.shields.io/badge/Bot-grey?logo=telegram)](https://core.telegram.org/bots)
[![Python](https://img.shields.io/badge/Python-3.10-blue.svg)](https://www.python.org/downloads/release/python-3100/)
[![License](https://img.shields.io/github/license/nessshon/mytonprovider-bot)](https://github.com/nessshon/mytonprovider-bot/blob/master/LICENSE)
[![Redis](https://img.shields.io/badge/Redis-Yes?logo=redis\&color=white)](https://redis.io/)
[![Docker](https://img.shields.io/badge/Docker-blue?logo=docker\&logoColor=white)](https://www.docker.com/)

**[English version](README.md)**

Telegram-–±–æ—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ **TON Storage –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤** –≤ —Å–µ—Ç–∏ TON —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

## –û–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞—Ö
—Å [mytonprovider.org](https://mytonprovider.org), —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —É–¥–æ–±–Ω—ã–π
–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ Telegram –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞, –ø–æ–¥–ø–∏—Å–∫–∏ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
* –ü–æ–∏—Å–∫ –ø–æ –ø—É–±–ª–∏—á–Ω–æ–º—É –∫–ª—é—á—É
* –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
* –í–∫–ª—é—á–µ–Ω–∏–µ –∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (CPU, RAM, –¥–∏—Å–∫, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –¥—Ä.)
* –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (RU, EN, ZH-TW)
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
* –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤ –ø–æ —Ç—Ä–∞—Ñ–∏–∫—É –∏ –∑–∞—Ä–∞–±–æ—Ç–∫—É

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* Python 3.10+
* Redis
* Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env`:

   ```bash
   cp .env.example .env
   ```

2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è              | –û–ø–∏—Å–∞–Ω–∏–µ                                 | –ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏—è                               |
|-------------------------|------------------------------------------|-----------------------------------------------|
| `BOT_TOKEN`             | –¢–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞ –æ—Ç @BotFather        | `1234567890:AAE...`                           |
| `TONCENTER_API_KEY`     | –ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞ –∫ TONCenter API             | `abcd1234efgh5678...`                         |
| `MYTONPROVIDER_API_KEY` | –ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞ –∫ MyTONProvider API         | `abcd1234efgh5678...`                         |
| `DB_URL`                | –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö         | `sqlite+aiosqlite:///./data/database.sqlite3` |
| `REDIS_URL`             | –ê–¥—Ä–µ—Å Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è       | `redis://localhost:6379/0`                    |
| `ADMIN_PASSWORD`        | –ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –ø–∞–Ω–µ–ª–∏/–¥–æ—Å—Ç—É–ø–∞ | `supersecret`                                 |

### –ó–∞–ø—É—Å–∫

#### –õ–æ–∫–∞–ª—å–Ω–æ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
alembic upgrade head

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
python -m app
```

#### –ß–µ—Ä–µ–∑ Docker

```bash
# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
    .
    ‚îú‚îÄ‚îÄ app/                                # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    ‚îÇ   ‚îú‚îÄ‚îÄ alert/                          # –°–∏—Å—Ç–µ–º–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π
    ‚îÇ   ‚îú‚îÄ‚îÄ api/                            # –í–Ω–µ—à–Ω–∏–µ API
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mytonprovider/              # –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è MyTONProvider API
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ toncenter/                  # –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è TONCenter API
    ‚îÇ   ‚îú‚îÄ‚îÄ bot/                            # Telegram-–±–æ—Ç
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dialogs/                    # –î–∏–∞–ª–æ–≥–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/                   # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middlewares/                # Middleware
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/                      # –£—Ç–∏–ª–∏—Ç—ã
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ commands.py                 # –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
    ‚îÇ   ‚îú‚îÄ‚îÄ database/                       # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/                     # SQLAlchemy-–º–æ–¥–µ–ª–∏
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository.py               # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ unitofwork.py               # –ü–∞—Ç—Ç–µ—Ä–Ω Unit of Work
    ‚îÇ   ‚îî‚îÄ‚îÄ scheduler/                      # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
    ‚îÇ       ‚îî‚îÄ‚îÄ jobs/                       # –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
    ‚îÇ           ‚îú‚îÄ‚îÄ sync_providers/         # –ó–∞–¥–∞—á–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
    ‚îÇ           ‚îú‚îÄ‚îÄ alerts_dispatch.py      # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ä–∞—Å—Å—ã–ª–∫–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π
    ‚îÇ           ‚îú‚îÄ‚îÄ monthly_reports.py      # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤
    ‚îÇ           ‚îî‚îÄ‚îÄ update_wallets.py       # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
    ‚îú‚îÄ‚îÄ alembic/                            # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    ‚îú‚îÄ‚îÄ locales/                            # –§–∞–π–ª—ã –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
    ‚îú‚îÄ‚îÄ data/                               # –§–∞–π–ª—ã –±–∞–∑—ã –∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    ‚îî‚îÄ‚îÄ docker-compose.yml                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

* **MyTONProvider API** ‚Äî –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞—Ö –∏ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è
* **TONCenter API** ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –±–∞–ª–∞–Ω—Å—ã –∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

* **ProviderModel** ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–µ
* **ProviderHistoryModel** ‚Äî –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (–∞—Ä—Ö–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
* **TelemetryModel** ‚Äî —Ç–µ–∫—É—â–∞—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è –∏ –º–µ—Ç—Ä–∏–∫–∏
* **TelemetryHistoryModel** ‚Äî –∏—Å—Ç–æ—Ä–∏—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ (—Å—Ä–µ–∑—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏)
* **WalletModel** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
* **WalletHistoryModel** ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∫–æ—à–µ–ª—å–∫–∞ (–±–∞–ª–∞–Ω—Å—ã, –¥–æ—Ö–æ–¥—ã)
* **UserModel** ‚Äî –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
* **UserSubscriptionModel** ‚Äî –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
* **UserAlertSettingModel** ‚Äî –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π
* **UserTriggeredAlertModel** ‚Äî –∂—É—Ä–Ω–∞–ª —Å—Ä–∞–±–æ—Ç–∞–≤—à–∏—Ö –æ–ø–æ–≤–µ—â–µ–Ω–∏–π

### –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á

* **sync_providers/update_providers** ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
* **sync_providers/update_telemetry** ‚Äî —Å–±–æ—Ä –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏
* **update_wallets** ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
* **alerts_dispatch** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ä–∞—Å—Å—ã–ª–∫–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π
* **monthly_reports** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤

## –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π [Apache-2.0](LICENSE).
